# 项目详情

本文档包含了关于"雷霆战机"游戏机制和技术方面的更详细信息。

## 内部游戏机制

### 玩家系统
- **僚机**：玩家可以拥有可配置数量的僚机（默认最多2架），通过收集 `Wing-manItem` 获得。僚机会为玩家抵挡一次攻击并自我牺牲。初始数量、最大数量和编队间距均可在 `constants.py` 文件中配置。
- **导弹**：僚机会周期性地发射追踪导弹。这些导弹会寻找最近的敌人，并在Boss激活时优先攻击Boss。

### 敌人系统
- **敌人等级**：敌人等级范围为0-10级。等级越高，生命值、速度和攻击力越强。
- **敌人生成**：随着游戏时间和游戏关卡的推进，敌人的数量和等级会增加。
- **敌人射击**：2级及以上的敌人可以射击（可通过 `ENEMY_SHOOT_LEVEL` 常量配置）。射速和子弹速度随等级提升。
  - 低等级敌人：发射简单的子弹，直线下降。
  - 中等级敌人：发射更快的子弹，可能有更复杂的移动模式。
  - 高等级敌人：发射速度更快、伤害更高的子弹。

### 子弹系统
- **玩家子弹**：根据收集的道具，最多可拥有4条射击弹道。
- **敌人子弹**：根据敌人等级，外观、速度和伤害各不相同。
- **Boss子弹**：特殊的大型子弹，伤害更高。

### 道具系统
- **生命道具（HealthItem）**：恢复玩家生命值。
- **子弹加速道具（BulletSpeedItem）**：提升玩家子弹速度。
- **弹道增加道具（BulletPathItem）**：增加玩家的射击弹道数量。
- **玩家加速道具（PlayerSpeedItem）**：提升玩家的移动速度。
- **僚机道具（WingmanItem）**：增加一架僚机与玩家并肩作战。
- **道具生成**：随着游戏进行和击败敌人获得分数，道具会随机生成。

### Boss 系统
- **Boss等级**：Boss等级范围为1-10级，等级由游戏进度决定（游戏关卡 // 3 + 随机(1,2)）。
- **Boss生成**：Boss从游戏关卡2级开始每30秒生成一次。在早期关卡（0-1级）不会出现Boss。
- **Boss生命系统**：
  - 基础生命值：100 + (等级-1) × 50点
  - Boss上方显示生命条和等级指示器
  - 生命条根据攻击模式变化颜色
- **Boss攻击模式**：Boss具有三种不同的攻击模式，根据生命值百分比变化：
  - **普通模式**（100%-50%生命值）：标准子弹模式
    - 1级：3颗子弹直线排列
    - 2级：4颗子弹扇形分布
    - 3级+：5颗子弹更宽扇形分布
  - **激进模式**（50%-25%生命值，仅2级+）：增加子弹数量和射速
    - 射击间隔减少30%
    - 更多子弹，更宽的散布模式
    - 生命条显示黄色边框警告
  - **终极模式**（25%-0%生命值，仅3级+）：最高强度，带玩家追踪
    - 射击间隔再减少20%
    - 最大子弹数量（3级+最多7颗子弹）
    - 部分子弹追踪玩家位置
    - 生命条显示闪烁红色边框
- **Boss移动**：
  - 入场动画：从屏幕顶部滑下
  - 水平移动：左右移动模式，动态边界
  - 移动速度随游戏关卡增加
  - 移动范围根据游戏进度调整
- **Boss子弹**：特殊子弹系统，具有基于模式的特性：
  - **普通子弹**：洋红色，标准速度（5像素/帧），15点伤害
  - **激进子弹**：橙红色，更快速度（7像素/帧），20点伤害，大20%
  - **终极子弹**：青色，最快速度（9像素/帧），25点伤害，大50%，玩家追踪
- **视觉效果**：
  - 多层伤害闪现效果（白色、红色、黄色）
  - 生命条上的攻击模式指示器
  - 多层发光子弹效果
- **Boss击败奖励**：击败Boss提供分数奖励（Boss等级 × 500分）并立即触发关卡升级。

### 关卡等级系统
- **早期游戏（0-1级）**：玩家通过分数积累来升级。这提供了一个友好的学习阶段，玩家可以在没有Boss压力的情况下熟悉游戏机制。
- **中后期游戏（2级以上）**：关卡升级完全依靠击败Boss。分数积累不再触发关卡升级，创造了一个基于技巧的升级系统。
- **双重升级机制**：
  - 基于分数的升级：仅适用于0→1级和1→2级
  - 基于Boss击败的升级：从2级开始可用，提供更大的奖励和挑战
- **清晰的升级路径**：玩家在升级时会收到清晰的视觉通知，包括清除的敌机数量和获得的奖励分数。

### 视觉效果系统
- **爆炸效果**：当一个实体（敌人、僚机）被摧毁时，或当导弹击中目标时触发。
- **闪现效果**：用于非致命伤害。实体本身会闪烁特定颜色以表明被击中。这提供了更清晰的反馈，且不会使屏幕混乱。
    - 玩家被击中：闪烁白色。
    - Boss被子弹击中：闪烁黄色。
    - Boss被导弹击中：闪烁红色（伴随导弹的爆炸效果）。

### 音效系统
- **背景音乐**：在游戏过程中循环播放。
- **爆炸音效**：在敌人被摧毁时播放。
- **命中音效**：在玩家受到伤害时播放。
- **死亡音效**：在玩家飞船被摧毁时播放。
- **道具拾取音效**：在收集道具时播放。
- **Boss被击败音效**：在成功击败Boss时播放。
- **音量控制**：可以调节音效和音乐的音量。
- **系统稳定性**：音效系统包含一个强大的健康检查和自动恢复机制。它会周期性地检查自身状态，并在检测到问题时（例如背景音乐意外停止）自动重新初始化。这确保了在长时间游戏过程中的高可靠性。

### 日志系统
- 支持不同级别（DEBUG、INFO、WARNING、ERROR、CRITICAL）的标准化日志输出。
- 可通过 `THUNDER_FIGHTER_LOG_LEVEL` 环境变量调整日志级别（详见 `README.md` 中的 [如何运行](#how-to-run)）。
- 所有游戏事件均以英文记录，便于调试和监控。

## 音频资源

游戏使用位于 `assets/` 目录下的以下音效和音乐文件：

1. **音效 (`sounds/`)**:
   - `player_hit.wav` - 玩家被击中音效
   - `player_death.wav` - 玩家死亡音效
   - `enemy_explosion.wav` - 敌人爆炸音效
   - `boss_death.wav` - Boss死亡音效
   - `item_pickup.wav` - 道具拾取音效

2. **音乐 (`music/`)**:
   - `background_music.mp3` - 游戏背景音乐

如果这些文件缺失，游戏会优雅地处理，记录一条警告但不会影响游戏运行。

## 开发状态

- ✅ 核心游戏机制已实现
- ✅ 具有不同行为的敌人系统
- ✅ 具有独特模式的Boss战
- ✅ 道具掉落和收集系统
- ✅ 带增强稳定性和音量控制的音效系统
- ✅ 全面的测试覆盖率（78个测试通过）
- ✅ 优化的视觉反馈系统（爆炸 vs. 伤害闪现）
- ✅ 多语言支持（英文、中文）
- ✅ 带通知的动态UI
- ✅ 可配置的游戏参数（僚机、敌人数量等）

## 技术细节

- 游戏实体设计采用面向对象编程。
- Pygame精灵组（Sprite Groups）管理游戏对象和碰撞检测。
- 自定义渲染系统创建游戏视觉效果。
- 集中式的 `FlashEffectManager` 用于处理实体伤害闪现。
- 标准化日志系统追踪游戏事件。
- 音效管理器控制游戏音频播放，具有强大的健康检查和自动恢复系统。
- **高级Boss系统架构**：
  - 基于状态的攻击模式管理，生命值触发模式转换
  - 动态子弹生成，具有模式特定属性和目标追踪
  - 多层视觉效果系统，预计算闪现序列
  - 基于游戏进度的自适应移动边界
  - 基于遮罩的精确碰撞检测
  - 带模式指示器的实时生命条渲染
- **Boss子弹系统**：
  - 工厂模式用于模式特定的子弹创建
  - 基于攻击模式的动态大小和颜色调整
  - 终极模式子弹的玩家追踪算法
  - 增强视觉效果的多层发光效果
- 模块化架构便于扩展和维护。
- 测试驱动开发确保代码质量和可靠性。
- 本地化系统支持多语言。 